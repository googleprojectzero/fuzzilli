{
  "body": "Deopt continuation types and wiring for Array.prototype.forEach in Maglev:\n\n- Builtin continuation names: Builtin::kArrayForEachLoopLazyDeoptContinuation and Builtin::kArrayForEachLoopEagerDeoptContinuation.\n- They are used to construct DeoptFrameScope instances around specific regions in TryReduceArrayForEach:\n  1) Lazy deopt around ThrowIfNotCallable and around the callback call, to ensure exceptions or lazy deopts resume in the correct builtin continuation frame with parameters [receiver, callback, this_arg, k(index), length] or [receiver, callback, this_arg, next_index_int32, original_length]. Example:\n     DeoptFrameScope lazy_deopt_scope(this, Builtin::kArrayForEachLoopLazyDeoptContinuation, target,\n         base::VectorOf<ValueNode*>({receiver, callback, this_arg, GetSmiConstant(0), original_length}));\n     AddNewNode<ThrowIfNotCallable>({callback});\n  2) Eager deopt scopes around the index increment (Int32IncrementWithOverflow) and after callback for map and length checks:\n     DeoptFrameScope eager_deopt_scope(this, Builtin::kArrayForEachLoopEagerDeoptContinuation, target,\n         base::VectorOf<ValueNode*>({receiver, callback, this_arg, index_int32, original_length}));\n\n- The builtin definitions for these continuations are in builtins/array-foreach.tq, where transitioning javascript builtins ArrayForEachLoopEagerDeoptContinuation and ArrayForEachLoopLazyDeoptContinuation forward into ArrayForEachLoopContinuation with appropriate casted parameters.\n\n- MaglevGraphBuilder::DeoptFrameScope::IsLazyDeoptContinuationFrame explicitly treats kArrayForEachLoopLazyDeoptContinuation as a lazy continuation.\n\n- MaglevGraphBuilder maintains latest_checkpointed_frame_ and wraps it with any DeoptFrameScope data when creating lazy/eager deopt points, ensuring that exception handler and lazy deopt points created by nodes (e.g., ThrowIfNotCallable) have the builtin continuation frames attached to the deopt info.\n",
  "context": [
    "maglev_array_foreach",
    "foreach_builder_entrypoints"
  ],
  "explanation": "Captures exactly how Maglev wires deopt continuation frames for the forEach loop lowering, including the parameters passed and where eager vs lazy scopes are positioned. It links the IR nodes to the builtin TQ continuations.",
  "file_line": "maglev/maglev-graph-builder.cc:8127-8135, 8200-8208, 8241-8249, 8288-8296; builtins/array-foreach.tq:6-40"
}