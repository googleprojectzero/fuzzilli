{
  "body": "Metadata: {\"stage\":\"1\",\"code_region\":\"keyed_store_ic_elements_transition\",\"topic\":[\"IC\",\"ElementsKind\",\"Transition\",\"TurboFan\",\"Maglev\"],\"type\":\"summary\"}\n\nCompiler consumption (TurboFan & Maglev) \u2014 source-anchored summary\n\nSummary: This entry documents how the element-store and elements-kind transition semantics (emitted by IC-builtins/CSA) are consumed and specialized by the optimizing compilers (Turbofan and Maglev). Key lowering nodes (TransitionElementsKind, TransitionElementsKindOrCheckMap) and the mapping from IC feedback to compiler access-info and lowering are referenced.\n\nKey anchors and files:\n- Turbofan/Simplified & Typed lowering: compiler/simplified-lowering.cc handles IrOpcode::kTransitionElementsKind and kTransitionElementsKindOrCheckMap lowering (simplified-lowering.cc:4746-4751). js-typed-lowering.cc and compiler/access-info.{cc,h} contain AccessInfo and typed lowering that reads elements kinds and feedback to produce typed store nodes.\n- JS native-context specialization uses TransitionElementsKindOrCheckMap nodes: compiler/js-native-context-specialization.cc (js-native-context-specialization.cc:2288,2327) inserts TransitionElementsKindOrCheckMap into the graph when appropriate.\n- Turboshaft/Turbolev: Turboshaft/turbolev-graph-builder.cc and turboshaft operation definitions include TransitionElementsKindAndCheckMap operations and runtime-call descriptors for TransitionElementsKind (compiler/turboshaft/runtime-call-descriptors.h; compiler/turboshaft/operations.h).\n- Maglev graph builder: maglev/maglev-graph-builder.cc provides TryBuildElementStoreOnJSArrayOrJSObject and BuildTransitionElementsKindOrCheckMap logic which attempts to lower element-store calls into Maglev nodes or otherwise to call runtime/builtin. Anchors: maglev/maglev-graph-builder.cc:6224, 4367, 6484.\n\nWhat compilers expect/consume from ICs:\n- FeedbackVector encoded handler kinds map to lowered modes: e.g., StoreHandler Smi encoding of ElementsKindBits + KeyedAccessStoreModeBits is read by compiler::access-info and by native-context specialization to decide whether the store can be lowered to a monomorphic element store node, whether a TransitionElementsKind node must be inserted, or whether to generate a (call) builtin to ElementsTransitionAndStore.\n- TransitionElementsKind nodes in the intermediate representation correspond to runtime TransitionElementsKind runtime calls if lowering can't statically determine the new map; optimizations such as load-elimination, typed-optimization and simplifications may fold or eliminate redundant transitions when maps are provably stable.\n\nGuarding and deopt considerations in compiler lowering:\n- The compilers model map checks and elements-kind checks as guard checks; if TransitionElementsKind may mutate the object map, lowering must account for potential map change and insert frame states (checkpoint) or fallback runtime calls. See compiler/load-elimination.cc and compiler/js-native-context-specialization.cc for handling of TransitionElementsKind nodes and their side effects.\n\nInternal RAG citations used in this document: [keyed_store_ic_elements_transition.overview_topology, keyed_store_ic_elements_transition.handlers_catalog, keyed_store_ic_elements_transition.elements_accessor_transitions]\n\nFileLine anchors: compiler/simplified-lowering.cc:4746-4751; compiler/js-native-context-specialization.cc:2288-2327; maglev/maglev-graph-builder.cc:4367,6224,6484; compiler/turboshaft/operations.h (TransitionElementsKind ops).",
  "context": [
    "keyed_store_ic_elements_transition.overview_topology",
    "keyed_store_ic_elements_transition.handlers_catalog",
    "keyed_store_ic_elements_transition.elements_accessor_transitions"
  ],
  "explanation": "How TurboFan and Maglev consume IC/builtin-level element-store semantics, when TransitionElementsKind nodes are inserted, and what lowering/folding opportunities exist (including where compilers read FeedbackVector-encoded handler info).",
  "file_line": "compiler/simplified-lowering.cc:4746-4751; compiler/js-native-context-specialization.cc:2288-2327; maglev/maglev-graph-builder.cc:4367,6224,6484"
}