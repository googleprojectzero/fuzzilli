{
  "body": "Feature toggles and gates influencing JS\u2194Wasm wrappers\nFiles and anchors:\n- src/wasm/wrappers.cc\n  - ModifyThreadInWasmFlagScope guards thread-in-wasm flag update with trap_handler::IsTrapHandlerEnabled() [~82 ctor/dtor].\n  - BuildSwitchToTheCentralStackIfNeeded/BuildSwitchBackFromCentralStack handle central stack switching for wasm-to-JS calls [~980-1070]. Used when importing JS and in Suspend path.\n  - BuildSuspend(...) checks v8_flags.stress_wasm_stack_switching to trap on JS frames and to stress suspension paths [~1095-1160].\n  - BuildJSToWasmWrapper takes set_in_wasm_flag default true; clears/sets around calls.\n- src/wasm/wasm-objects.cc\n  - bool UseGenericWasmToJSWrapper(kind, sig, suspend) gates use of Torque generic wasm-to-JS wrapper by platform and v8_flags.wasm_generic_wrapper and suspend==kNoSuspend [end of file ~3530].\n  - JIT-less mode (v8_flags.wasm_jitless) redirects code paths to interpreter wrappers, stores function_index in dispatch table instead of code pointer (WasmDispatchTable::SetForNonWrapper/SetForWrapper jitless branches) and selects Builtin::kGenericWasmToJSInterpreterWrapper / Builtin::kGenericJSToWasmInterpreterWrapper in WasmJSFunction/WasmExportedFunction flows.\n  - V8_ENABLE_DRUMBRAKE (JSPI/stack switching, interpreter) guards suspender support and jitless behaviors across multiple sites (e.g., WasmTrustedInstanceData fields, dispatch table function_index, promising wrappers).\n- src/builtins/js-to-wasm.tq\n  - Builtins JSToWasmWrapper / WasmPromising / WasmStressSwitch use JSToWasmWrapperHelper, which supports Promise integration and a stack-switch stress mode; uses runtime::WasmAllocateSuspender when needed.\n- src/builtins/wasm-to-js.tq\n  - transitioning macro WasmToJSWrapper does SwitchToTheCentralStackIfNeeded / ModifyThreadInWasmFlag(0/1) and supports TierUpWasmToJSWrapper. Uses IterableToFixedArrayForWasm for multi-return.\n- src/compiler/wasm-compiler.cc / pipeline.cc\n  - Wrapper compilation jobs select Turboshaft wrapper pipeline, with phases gated by v8_flags.turboshaft_wasm_instruction_selection_staged, wasm_opt, and platform int64 lowering. JSPI-related code is under V8_ENABLE_DRUMBRAKE; several places check v8_flags.wasm_jitless.\nOther toggles indirectly affecting wrappers: Wasm GC/type features influence lowering/optimization phases (e.g., WasmGCLowering, WasmGCOptimizationPhase gated by v8_flags.wasm_opt), but wrapper call/convert logic is largely feature-agnostic aside from references/bigint/i64 paths.\n",
  "context": [
    "wrappers_ts_builders",
    "tf_wrappers_builders_pipeline",
    "compiler_pipeline_wasm_wrappers",
    "torque_wrappers_builtins",
    "wasm_objects_glue"
  ],
  "explanation": "Summarizes the flags and compile-time switches that change wrapper behavior: trap handler gating the thread-in-wasm flag, stack switching and suspender integration, generic wrapper enablement, jitless interpreter wrapper paths, and pipeline feature flags.",
  "file_line": "wrappers.cc:~82,~980-1160; wasm-objects.cc:~3400-3550; js-to-wasm.tq: top builtins; wasm-to-js.tq: WasmToJSWrapper; compiler/pipeline.cc: WasmTurboshaftWrapperCompilationJob"
}