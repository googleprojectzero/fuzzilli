{
  "body": "Stage:1 region:KeyedLoadIC_StringIndex_Protector\nTopic: inventory \u2014 Source mapping and symbol inventory for s[i] on strings.\n\nSummary:\nCurated list of the main source files and symbols that implement/drive the string-index fast-path (s[i]) and the associated protector dependency. Each entry includes a short role description.\n\nFiles & symbols (mainline names):\n- src/ic/ic.cc\n  - KeyedLoadIC::Load \u2014 entry used by runtime/IC miss to update feedback for keyed loads; calls UpdateLoadElement when index-like keys seen, and drives feedback transitions.\n  - KeyedLoadIC::UpdateLoadElement \u2014 updates keyed-load IC state for element-like receivers; picks LoadElementHandler for maps and configures vector.\n  - KeyedLoadIC::LoadElementHandler \u2014 returns the data/code handler for element/string cases; returns LoadHandler::LoadIndexedString for string receiver maps.\n  - KeyedLoadIC::LoadElementPolymorphicHandlers \u2014 composes polymorphic handlers for multiple receiver maps.\n  Role: central IC state machine for keyed loads; observes feedback and installs handlers (including kIndexedString).\n\n- src/ic/handler-configuration.h & src/ic/handler-configuration-inl.h / .cc\n  - class LoadHandler \u2014 DataHandler encoding/decoding helper for load handlers.\n  - enum LoadHandler::Kind::kIndexedString \u2014 handler kind representing the string-index fast-path (Smi-encoded data handler).\n  - LoadHandler::LoadIndexedString(Isolate*, KeyedAccessLoadMode) \u2014 creates the Smi handler for an indexed-string load.\n  - AllowOutOfBoundsBits, GetHandlerKind \u2014 fields and decoders used by CSAs and builtin trampolines to branch to string-index path.\n  Role: encodes/decodes the handler configuration used by ICs and generated code to recognize the string-index fast-path.\n\n- src/ic/accessor-assembler.cc\n  - AccessorAssembler::GenerateKeyedLoadIC (and _Megamorphic, Trampoline, Baseline variants) \u2014 CodeStubAssembler-generated builtin that dispatches based on handler kind; contains branch for LOAD_KIND(kIndexedString) and emits the CSA string-index implementation.\n  Role: CSA glue that dispatches runtime-dispatched Smi handler kinds into optimized assembly sequences (string-index fast path among them).\n\n- src/builtins/builtins-ic-gen.cc\n  - Builtins::Generate_KeyedLoadIC, Generate_KeyedLoadIC_Megamorphic, Generate_KeyedLoadICBaseline, KeyedLoadICTrampoline \u2014 generate the builtin entry points for keyed-load IC fast/slow/megamous paths and baseline trampoline used by baseline tier.\n  Role: builtin entrypoints that ICs and baseline tier call into for keyed load handling.\n\n- src/execution/protectors.h / protectors-inl.cc / protectors.cc\n  - Protectors::IsStringWrapperToPrimitiveIntact/is intact query and Protectors::InvalidateStringWrapperToPrimitive \u2014 runtime helpers to query/invalidate the protector cell.\n  - RootIndex::kStringWrapperToPrimitiveProtector (C root cell identifier: string_wrapper_to_primitive_protector)\n  Role: protector cell used to record that String.prototype chain hasn\u2019t been modified in a way that would make treating wrappers like primitives observable for indexed access.\n  Note: external docs sometimes call this StringWrapperSafeForIndexedAccess; map this variant to the mainline name StringWrapperToPrimitiveProtector.\n\n- src/execution/isolate.cc\n  - Isolate::UpdateStringWrapperToPrimitiveProtectorOnSetPrototype \u2014 called when prototype changes that might affect the protector; invalidates protector appropriately.\n  Role: hooks into prototype mutation operations to maintain the protector.\n\n- src/objects/lookup.cc\n  - lookup logic consults Protectors::IsStringWrapperToPrimitiveIntact to allow fast-paths when prototype hasn't been observed to change; some paths may call Protectors::InvalidateStringWrapperToPrimitive when defining properties on String.prototype.\n  Role: lookup code that uses protector to decide whether string wrapper fast-path is allowed.\n\n- src/interpreter/interpreter-generator.cc & src/interpreter/bytecode-generator.cc\n  - Emission for GetKeyedProperty that calls Builtin::kKeyedLoadIC and assigns FeedbackSlotKind::kLoadKeyed (via feedback_spec AddKeyedLoadICSlot()).\n  Role: connects bytecode keyed property loads to the KeyedLoadIC feedback vector slots.\n\n- src/compiler/js-native-context-specialization.cc\n  - JSNativeContextSpecialization::BuildIndexedStringLoad \u2014 IR-level helper for TurboFan to build an indexed-string fast path when feedback indicates strings.\n  Role: TF specialization that generates optimized sequence for indexed string loads.\n\n- src/compiler/compilation-dependencies.(h|cc)\n  - CompilationDependencies::DependOnStringWrapperToPrimitiveProtector() \u2014 attaches dependency so optimized code gets deoptimized when protector invalidates.\n  Role: TF dependency bookkeeping for protector.\n\n- src/maglev/maglev-graph-builder.cc & src/maglev/maglev-ir.h\n  - CheckStringOrStringWrapper nodes; MaglevGraphBuilder uses DependOnStringWrapperToPrimitiveProtector() when constructing a fast string-index path.\n  Role: Maglev-side consumption of feedback and protector dependency.\n\n- src/baseline/baseline-compiler.cc\n  - CallBuiltin(Builtin::kKeyedLoadICBaseline) usage for baseline trampoline.\n  Role: Baseline tier uses IC trampolines to get the same dispatch semantics as CSA/builtins.\n\nNotes: Role descriptions give what each symbol/file contributes to the s[i] fast path. All symbol names correspond to current mainline filenames and symbol names discovered in the repo.",
  "context": [
    "KeyedLoadIC",
    "LoadIndexedString",
    "AccessorAssembler.GenerateKeyedLoadIC",
    "Protectors.StringWrapperToPrimitive",
    "CompilationDependencies.DependOnStringWrapperToPrimitiveProtector"
  ],
  "explanation": "Primary inventory mapping: tells what files and symbols implement the s[i] indexed-string fast-path and protector dependency (string_wrapper_to_primitive_protector). Useful as a starting index for Stage 1 exploration.",
  "file_line": "src/ic/ic.cc:KeyedLoadIC::Load,UpdateLoadElement,LoadElementHandler,LoadElementPolymorphicHandlers; src/ic/handler-configuration.h:LoadHandler,kIndexedString,LoadIndexedString; src/ic/accessor-assembler.cc:GenerateKeyedLoadIC; src/builtins/builtins-ic-gen.cc:Generate_KeyedLoadIC; src/execution/protectors.h:Protectors::IsStringWrapperToPrimitiveIntact; src/execution/isolate.cc:UpdateStringWrapperToPrimitiveProtectorOnSetPrototype; src/objects/lookup.cc:usage of protector; src/interpreter/interpreter-generator.cc:GetKeyedProperty; src/compiler/js-native-context-specialization.cc:BuildIndexedStringLoad; src/compiler/compilation-dependencies.cc:DependOnStringWrapperToPrimitiveProtector; src/maglev/maglev-graph-builder.cc:DependOnStringWrapperToPrimitiveProtector"
}