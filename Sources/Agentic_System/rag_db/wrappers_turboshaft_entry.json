{
  "body": "File: src/wasm/wrappers.cc\n- Class: v8::internal::wasm::WasmWrapperTSGraphBuilder (Turboshaft-based wrapper graph builder)\n  Key methods:\n  - BuildJSToWasmWrapper(bool do_conversion=true, OptionalOpIndex frame_state = Nullopt, bool set_in_wasm_flag = true): Entry to build JS\u2192Wasm stubs. Creates JS closure/context params, loads WasmFunctionData from SFI, fast-path conversion for i32/f32/f64, default path via FromJS(), calls BuildCallAndReturn() with thread_in_wasm flag handling and return value boxing (ToJS for multiple/single returns; allocate JSArray via Builtin::kWasmAllocateJSArray).\n  - BuildWasmToJSWrapper(ImportCallKind kind, int expected_arity, Suspend suspend): Entry to build Wasm\u2192JS import stubs. Forms JS call frame (receiver, new target, arg count, optional dispatch handle) based on ImportCallKind. Switches to central stack if needed, clears thread_in_wasm, calls JS via GetJSCallDescriptor or CallTrampolineDescriptor, supports suspension (promises) via Builtin::kWasmSuspend and promise.then, then converts returns back to Wasm via FromJS() for each result; restores thread_in_wasm and stack.\n  - BuildCapiCallWrapper(): Entry to build Wasm\u2192C-API wrappers. Marshals params/returns through a stack slot, retrieves host_data from WasmCapiFunctionData, clears/restores thread_in_wasm, calls host target with C signature, rethrows via Builtin::kWasmRethrowExplicitContext on non-zero return.\n  - BuildCallWasmFromWrapper, BuildCallAndReturn: Helper to perform Wasm indirect call using compiler::GetWasmCallDescriptor(WasmCallKind::kWasmIndirectFunction), create TSCallDescriptor, place implicit first arg (trusted instance/import data), handle multiple returns projections.\n  - FromJS/ToJS/FromJSFast: Marshalling helpers for JS\u2194Wasm values. Covers i32/i64(BigInt)/f32/f64, refs (externref,string,funcref with WasmInternalFunction\u2192external wrapping), null handling. Uses Builtins: kWasmTaggedToFloat64, kWasmTaggedNonSmiToInt32, kWasmInt32ToHeapNumber, kWasmFloat32ToNumber, kWasmFloat64ToNumber, kBigIntToI64/kBigIntToI32Pair.\n  - Thread-in-wasm flag: ModifyThreadInWasmFlagScope RAII sets/clears Isolate::thread_in_wasm when calling into wasm or JS, guarded by trap_handler.\n  - Stack switching: BuildSwitchToTheCentralStackIfNeeded/Back for JS Promise integration (suspend), touching IsolateData is_on_central_stack_flag, central_stack_{sp,limit}, saving stack switch info in WasmContinuationObject::StackMemory.\n  - Uses CallDescriptors: compiler::Linkage::GetJSCallDescriptor for JS calls; Linkage::GetStubCallDescriptor for builtins; compiler::GetWasmCallDescriptor for calls into wasm; TSCallDescriptor::Create for TS world.\n- Top-level pipeline entry:\n  void BuildWasmWrapper(PipelineData*, AccountingAllocator*, compiler::turboshaft::Graph&, const CanonicalSig*, WrapperCompilationInfo): Dispatches on CodeKind to build one of JS_TO_WASM_FUNCTION, WASM_TO_JS_FUNCTION (with import_kind, expected_arity, suspend), or WASM_TO_CAPI_FUNCTION by invoking corresponding methods above.\n",
  "context": [
    "wasm_wrappers_ts_overview",
    "wasm_call_desc_anchors",
    "js_to_wasm_cache_tiering",
    "wasm_to_js_cache",
    "wasm_objects_classes",
    "runtime_tiering_points"
  ],
  "explanation": "This entry captures the Turboshaft wrapper builder implementation and the exact wrapper pipeline entry point. It enumerates the core marshalling, thread-in-wasm flag logic, stack switching for suspension, and descriptor usage, with concrete method anchors in src/wasm/wrappers.cc. This is central to understanding JS\u2194Wasm wrappers in the current architecture.",
  "file_line": "wasm/wrappers.cc:1-~"
}