{
  "body": "Core fast-path implementation lives in src/json/json-stringifier.cc. Key types and flows:\n- FastJsonStringifier<Char> (templated on Char = uint8_t or base::uc16) implements the side-effect-free fast traversal and segmented Zone-backed OutBuffer storage.\n- OutBuffer<Char> implements segmented buffers (kSegmentLength = 2048) stored in ZoneList<base::Vector<Char>> segments_; Zone allocator used: Zone zone_ instantiated with isolate->allocator(). append operations: AppendCharacter, Append(chars,length), CopyTo.\n- ContinuationRecord stack holds continuation frames: kObject, kArray, kResumeFromOther, kObjectKey for iterative traversal without recursion; FastJsonStringifier::stack_ is std::vector<ContinuationRecord>.\n- FastJsonStringifier::SerializeObject(Tagged<JSAny>, DisallowGarbageCollection&) starts with TrySerializeSimpleObject and falls back to iterative SerializeObject(object, obj_cont_idx, array_cont_idx).\n- ResumeFrom<OldChar> allows switching from one-byte stringifier to two-byte stringifier: copies continuation stack and resumes.\n- TrySerializeSimpleObject handles primitive/simple strings/numbers/oddballs and returns sentinel results (SUCCESS, UNCHANGED, UNDEFINED, CHANGE_ENCODING, SLOW_PATH, EXCEPTION) for the runner.\n- Buffer concatenation after encoding switch handled in FastJsonStringify: if CHANGE_ENCODING, construct two_byte_stringifier and call ResumeFrom(one_byte_stringifier). After success, allocate final Seq*String and CopyResultTo for both parts (one_byte then two_byte).\n- Mid-run width switch: one-byte FastJsonStringifier returns CHANGE_ENCODING when encountering two-byte strings (SerializeObjectKey/SerializeString templates check and return CHANGE_ENCODING if is_one_byte and string is two-byte). ResumeFrom transfers stack and serializes remaining data into two-byte buffer.\n- Rejection logic: TrySerializeSimpleObject switches on instance types. It accepts INTERNALIZED_ONE_BYTE/SEQ_ONE_BYTE/EXTERNAL_ONE_BYTE/THIN_ONE_BYTE -> maps to SeqOneByteString/ExternalOneByteString or resolves ThinString. Two-byte variants similarly. For strings requiring escaping, AppendStringChecked scans and escapes; Non-flat/exotic strings often cause SLOW_PATH.\n- Escaping/scanning: AppendStringChecked iterates over chars, uses DoNotEscape lookup and JsonEscapeTable for replacements. Surrogate handling for two-byte strings uses range checks (0xD800-0xDFFF) and emits \\uXXXX sequences. TODO mentions SIMD not implemented.\n- Hidden-class fast-json-iterable key shortcut: SerializeJSObject/SerializeJSArray in fast path require CanFastSerializeJSObjectFastPath and CanFastSerializeJSArrayFastPath (checks prototype and may_have_interesting_properties). For object key serialization, fast path assumes internalized keys and reads descriptors directly via map->instance_descriptors; TrySerializeSimpleObject used to serialize property values without boxing.\n- Entry glue: builtins/builtins-json.cc -> BUILTIN(JsonStringify) calls JsonStringify(isolate, object, replacer, indent). JsonStringify in json-stringifier.cc checks CanUseFastStringifier(replacer,gap) (v8_flags.json_stringify_fast_path && replacer/gap undefined) and dispatches to FastJsonStringify or JsonStringifier (slow path class).\n- GC/interrupt/deopt safety seams: FastJsonStringifier uses Zone and DisallowGarbageCollection / DisableGCMole pairs to avoid allocations on fast path; uses StackLimitCheck and explicit HandleInterruptAndCheckCycle to check interrupts; CheckCycle uses unordered_set of addresses to detect cycles; ResumeFrom and CopyResultTo operate under AllowGarbageCollection only when allocating final result; continuations avoid touching heap after certain points. TrySerializeSimpleObject uses DisableGCMole and DisallowGC.\n",
  "context": [
    "json_stringify_fastpath"
  ],
  "explanation": "High-level bundle describing the fast-path core implementation, buffers, continuation/iterative traversal, one-byte<->two-byte switch, string handling and fallbacks, fast property key shortcutting, entry glue and GC/interrupt safety seams.",
  "file_line": "json/json-stringifier.cc: entire file"
}