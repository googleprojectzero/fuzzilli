{
  "body": "Elements accessor transitions and growth (source-anchored)\n\nSummary: This document summarizes how V8 implements element-kind transitions and capacity growth when performing element stores that may require converting the backing store between representations (e.g., PACKED_SMI_ELEMENTS -> PACKED_DOUBLE_ELEMENTS -> PACKED_ELEMENTS -> HOLEY_*), handling copy-on-write (COW) backing stores and growing capacity. The core conversion and growth functions are defined in src/objects/elements.cc and are invoked by JSObject::TransitionElementsKind and various builtins/CSA helpers.\n\nKey functions and anchors:\n- JSObject::TransitionElementsKind and templated impls: objects/elements.cc:991-1114 (TransitionElementsKindImpl, GrowCapacityAndConvertImpl, ConvertElementsWithCapacity) and objects/elements.cc:4937-4943 (another TransitionElementsKindImpl specialization)\n- ConvertElementsWithCapacity / GrowCapacityAndConvertImpl / BasicGrowCapacityAndConvertImpl implementations: objects/elements.cc:~948-1063 (ConvertElementsWithCapacity and GrowCapacity impls), objects/elements.cc:2264: where GrowCapacityAndConvertImpl is invoked in array insertion paths\n- Where JSObject::TransitionElementsKind is invoked: ic/ic.cc:3256 (IC path calling JSObject::TransitionElementsKind via Runtime), builtins/builtins-handler-gen.cc:164-176 (TransitionElementsKind called inside the ElementsTransitionAndStore builtins before EmitElementStore)\n- Copy-on-write handling and EnsureWritable semantics: codegen/code-stub-assembler.cc:14240\u201314359 (CopyElementsOnWrite implementation and checks), key checks in KeyedStoreIC for COW stores: ic/ic.cc:~2400 (KeyedStoreIC::StoreElementHandler chooses NoTransitionGrowAndHandleCOW variants and StoreMode enums)\n\nGuard invariants:\n- Prototype chain validity: KeyedStoreIC attaches validity cells (Map::GetOrCreatePrototypeChainValidityCell) to handlers to ensure prototype structure hasn't changed; see ic/ic.cc:~2490 loops where validity_cell is set/wrapped into handler.\n- Capacity growth bounds: CheckForCapacityGrow and TryGrowElementsCapacity in code-stub-assembler implement exact checks to decide if GrowCapacityAndConvertImpl or BasicGrowCapacityAndConvertImpl should be invoked (codegen/code-stub-assembler.cc:14340 and 6653 respectively).\n- When switching to typed arrays or typed array stores are involved, typed array OOB and detached buffer semantics are enforced by PrepareValueForWriteToTypedArray (codegen/code-stub-assembler.cc:13646-13929) and builtin wrappers in builtins/builtins-typed-array-gen.cc that call into these helpers.\n\nTransitions supported (subset): PACKED_SMI -> HOLEY_SMI, PACKED_SMI -> PACKED_DOUBLE, PACKED_DOUBLE -> HOLEY_DOUBLE, PACKED_DOUBLE -> PACKED_ELEMENTS, PACKED_DOUBLE -> HOLEY_ELEMENTS, PACKED_ELEMENTS -> HOLEY_ELEMENTS and others enumerated in builtins/builtins-handler-gen.cc (ELEMENTS_KIND_TRANSITIONS list). Dictionary transitions are not handled by ElementsTransitionAndStore builtins.\n\nWrite barriers and stores:\n- When converting to object elements or storing HeapObjects, RecordWrite/StoreBuffer write-barrier emission occurs in CSA's EmitElementStore path (codegen/code-stub-assembler.cc:14094-14219), and in elements conversion paths where new backing stores are allocated and stores occur (objects/elements.cc conversion functions). Handle write barrier invariants: writes of HeapObjects trigger RecordWrite, Smi writes do not.\n\nInternal RAG citations: [keyed_store_ic_elements_transition.handlers_catalog, keyed_store_ic_elements_transition.overview_topology]\n\nFile:function anchors: objects/elements.cc:991-1114 (TransitionElementsKindImpl + conversions); codegen/code-stub-assembler.cc:14340 (CheckForCapacityGrow/TryGrowElementsCapacity/CopyElementsOnWrite); builtins/builtins-handler-gen.cc:141-193 (ElementsTransitionAndStore builtins).",
  "context": [
    "keyed_store_ic_elements_transition.handlers_catalog",
    "keyed_store_ic_elements_transition.overview_topology"
  ],
  "explanation": "Detailed summary of elements conversion, growth, COW handling and guards. Anchors show where transition and growth code lives and how CSA helpers and builtins integrate with elements.cc conversions.",
  "file_line": "objects/elements.cc:991-1114; codegen/code-stub-assembler.cc:14340-14359; builtins/builtins-handler-gen.cc:141-193"
}