{
  "body": "ThrowIfNotCallable emission and exception wiring in Maglev for Array.prototype.forEach:\n\n- In TryReduceArrayForEach, after extracting callback = args[0], Maglev validates callback is callable:\n  EnsureType(callback, NodeType::kCallable, [&](NodeType old_type) {\n    DeoptFrameScope lazy_deopt_scope(\n        this, Builtin::kArrayForEachLoopLazyDeoptContinuation, target,\n        base::VectorOf<ValueNode*>({receiver, callback, this_arg,\n                                    GetSmiConstant(0), original_length}));\n    AddNewNode<ThrowIfNotCallable>({callback});\n  });\n  This uses EnsureType with a lambda to insert a ThrowIfNotCallable node if the type wasn\u2019t previously known callable, inside a lazy deopt scope to maintain stack trace correctness.\n\n- Node class ThrowIfNotCallable appears in maglev-ir.h and codegen in maglev-ir.cc:\n  class ThrowIfNotCallable : public FixedInputNodeT<1, ThrowIfNotCallable> { ... } (OpProperties::CanThrow | OpProperties::DeferredCall)\n  GenerateCode uses JumpIfNotCallable and defers to runtime ThrowCalledNonCallable, then masm->DefineExceptionHandlerAndLazyDeoptPoint(node) to attach exception handler and lazy deopt metadata.\n\n- This ensures exceptions (TypeError) thrown by non-callable callback validation are wired to Maglev exception handling, associating the lazy deopt continuation frame (kArrayForEachLoopLazyDeoptContinuation) with the throw site.\n\n- Regarding catch handlers: MaglevGraphBuilder handles catch blocks via MergePointInterpreterFrameState::NewForCatchBlock in BuildMergeStates and uses masm->DefineExceptionHandlerAndLazyDeoptPoint for throwing nodes/calls. For forEach, the key is that ThrowIfNotCallable emits exception handler/lazy deopt point and the active DeoptFrameScope sets the lazy continuation to ArrayForEachLoopLazyDeoptContinuation so the interpreter/builtin continuation handles resumption correctly.\n",
  "context": [
    "maglev_array_foreach",
    "foreach_deopt_continuations",
    "foreach_builder_entrypoints"
  ],
  "explanation": "Documents how callback validation is emitted in Maglev and how exceptions are wired to deopt/handlers for forEach loop specialization. Points to the node definition and codegen that connect to runtime and exception handler points.",
  "file_line": "maglev/maglev-graph-builder.cc:8127-8135; maglev/maglev-ir.h:9740-9756; maglev/maglev-ir.cc:5424-5438"
}