std::stop_source - cppreference.com cppreference.com Create account Log in Namespaces Page Discussion Variants Views View Edit History Actions std:: stop_source From cppreference.com < cpp ‎ | thread C++ Compiler support Freestanding and hosted Language Standard library Standard library headers Named requirements Feature test macros (C++20) Language support library Concepts library (C++20) Diagnostics library Memory management library Metaprogramming library (C++11) General utilities library Containers library Iterators library Ranges library (C++20) Algorithms library Strings library Text processing library Numerics library Date and time library Input/output library Filesystem library (C++17) Concurrency support library (C++11) Execution control library (C++26) Technical specifications Symbols index External libraries [edit] Concurrency support library Threads thread (C++11) jthread (C++20) hardware_destructive_interference_size hardware_constructive_interference_size (C++17) (C++17) this_thread namespace get_id (C++11) yield (C++11) sleep_for (C++11) sleep_until (C++11) Cooperative cancellation stop_token (C++20) inplace_stop_token (C++26) never_stop_token (C++26) stop_source (C++20) inplace_stop_source (C++26) stop_callback (C++20) inplace_stop_callback (C++26) stop_callback_for_t (C++26) stoppable_token (C++26) unstoppable_token (C++26) stoppable-source (C++26) stoppable-callback-for (C++26) Mutual exclusion mutex (C++11) recursive_mutex (C++11) shared_mutex (C++17) timed_mutex (C++11) recursive_timed_mutex (C++11) shared_timed_mutex (C++14) Generic lock management lock (C++11) lock_guard (C++11) scoped_lock (C++17) unique_lock (C++11) shared_lock (C++14) once_flag (C++11) call_once (C++11) try_lock (C++11) defer_lock try_to_lock adopt_lock defer_lock_t try_to_lock_t adopt_lock_t (C++11) (C++11) (C++11) (C++11) (C++11) (C++11) Condition variables condition_variable (C++11) condition_variable_any (C++11) notify_all_at_thread_exit (C++11) cv_status (C++11) Semaphores counting_semaphore binary_semaphore (C++20) (C++20) Latches and Barriers latch (C++20) barrier (C++20) Futures promise (C++11) future (C++11) shared_future (C++11) packaged_task (C++11) async (C++11) launch (C++11) future_status (C++11) future_error (C++11) future_category (C++11) future_errc (C++11) Safe reclamation rcu_obj_base (C++26) rcu_domain (C++26) rcu_default_domain (C++26) rcu_synchronize (C++26) rcu_barrier (C++26) rcu_retire (C++26) Hazard pointers hazard_pointer_obj_base (C++26) hazard_pointer (C++26) make_hazard_pointer (C++26) Atomic types atomic (C++11) atomic_ref (C++20) atomic_flag (C++11) Initialization of atomic types atomic_init (C++11) (deprecated in C++20) ATOMIC_VAR_INIT (C++11) (deprecated in C++20) ATOMIC_FLAG_INIT (C++11) Memory ordering memory_order (C++11) kill_dependency (C++11) (deprecated in C++26) atomic_thread_fence (C++11) atomic_signal_fence (C++11) Free functions for atomic operations atomic_store atomic_store_explicit (C++11) (C++11) atomic_load atomic_load_explicit (C++11) (C++11) atomic_exchange atomic_exchange_explicit (C++11) (C++11) atomic_compare_exchange_weak atomic_compare_exchange_weak_explicit atomic_compare_exchange_strong atomic_compare_exchange_strong_explicit (C++11) (C++11) (C++11) (C++11) atomic_fetch_add atomic_fetch_add_explicit (C++11) (C++11) atomic_fetch_sub atomic_fetch_sub_explicit (C++11) (C++11) atomic_fetch_and atomic_fetch_and_explicit (C++11) (C++11) atomic_fetch_or atomic_fetch_or_explicit (C++11) (C++11) atomic_fetch_xor atomic_fetch_xor_explicit (C++11) (C++11) atomic_fetch_max atomic_fetch_max_explicit (C++26) (C++26) atomic_fetch_min atomic_fetch_min_explicit (C++26) (C++26) atomic_is_lock_free (C++11) atomic_wait atomic_wait_explicit (C++20) (C++20) atomic_notify_one (C++20) atomic_notify_all (C++20) Free functions for atomic flags atomic_flag_test_and_set atomic_flag_test_and_set_explicit (C++11) (C++11) atomic_flag_clear atomic_flag_clear_explicit (C++11) (C++11) atomic_flag_test atomic_flag_test_explicit (C++20) (C++20) atomic_flag_wait atomic_flag_wait_explicit (C++20) (C++20) atomic_flag_notify_one (C++20) atomic_flag_notify_all (C++20) [edit] std::stop_source Member functions stop_source::stop_source stop_source::~stop_source stop_source::operator= Modifiers stop_source::request_stop stop_source::swap Observers stop_source::get_token stop_source::stop_requested stop_source::stop_possible Non-member functions swap (std::stop_source) operator== Helper tags std::nostopstate std::nostopstate_t [edit] Defined in header <stop_token> class stop_source ; (since C++20) The stop_source class provides the means to issue a stop request, such as for std::jthread cancellation. A stop request made for one stop_source object is visible to all stop_source s and std::stop_token s of the same associated stop-state; any std::stop_callback (s) registered for associated std::stop_token (s) will be invoked, and any std::condition_variable_any objects waiting on associated std::stop_token (s) will be awoken. Once a stop is requested, it cannot be withdrawn. Additional stop requests have no effect. Contents 1 Member functions 1.1 Modifiers 1.2 Observers 2 Non-member functions 3 Helper tags 4 Notes 5 Example [ edit ] Member functions (constructor) constructs new stop_source object (public member function) [edit] (destructor) destructs the stop_source object (public member function) [edit] operator= assigns the stop_source object (public member function) [edit] Modifiers request_stop makes a stop request for the associated stop-state, if any (public member function) [edit] swap swaps two stop_source objects (public member function) [edit] Observers get_token returns a stop_token for the associated stop-state (public member function) [edit] stop_requested checks whether the associated stop-state has been requested to stop (public member function) [edit] stop_possible checks whether associated stop-state can be requested to stop (public member function) [edit] [ edit ] Non-member functions operator== (C++20) compares two std::stop_source objects (function) [edit] swap (std::stop_source) (C++20) specializes the std::swap algorithm (function) [edit] [ edit ] Helper tags nostopstate nostopstate_t (C++20) a tag used for stop_source to indicate no associated stop-state upon construction (tag) [edit] [ edit ] Notes For the purposes of std::jthread cancellation the stop_source object should be retrieved from the std::jthread object using get_stop_source() ; or stop should be requested directly from the std::jthread object using request_stop() . This will then use the same associated stop-state as that passed into the std::jthread 's invoked function argument (i.e., the function being executed on its thread). For other uses, however, a stop_source can be constructed separately using the default constructor, which creates new stop-state. Feature-test macro Value Std Feature __cpp_lib_jthread 201911L (C++20) Stop token and joining thread [ edit ] Example Run this code #include <chrono> #include <iostream> #include <stop_token> #include <thread> using namespace std :: chrono_literals ; void worker_fun ( int id, std:: stop_token stoken ) { for ( int i = 10 ; i ; -- i ) { std:: this_thread :: sleep_for ( 300ms ) ; if ( stoken. stop_requested ( ) ) { std:: printf ( " worker%d is requested to stop \n " , id ) ; return ; } std:: printf ( " worker%d goes back to sleep \n " , id ) ; } } int main ( ) { std:: jthread threads [ 4 ] ; std:: cout << std:: boolalpha ; auto print = [ ] ( const std :: stop_source & source ) { std:: printf ( "stop_source stop_possible = %s, stop_requested = %s \n " , source. stop_possible ( ) ? "true" : "false" , source. stop_requested ( ) ? "true" : "false" ) ; } ; // Common source std :: stop_source stop_source ; print ( stop_source ) ; // Create worker threads for ( int i = 0 ; i < 4 ; ++ i ) threads [ i ] = std:: jthread ( worker_fun, i + 1 , stop_source. get_token ( ) ) ; std:: this_thread :: sleep_for ( 500ms ) ; std:: puts ( "Request stop" ) ; stop_source. request_stop ( ) ; print ( stop_source ) ; // Note: destructor of jthreads will call join so no need for explicit calls } Possible output: stop_source stop_possible = true, stop_requested = false worker2 goes back to sleep worker3 goes back to sleep worker1 goes back to sleep worker4 goes back to sleep Request stop stop_source stop_possible = true, stop_requested = true worker3 is requested to stop worker1 is requested to stop worker2 is requested to stop worker4 is requested to stop Retrieved from " https://en.cppreference.com/mwiki/index.php?title=cpp/thread/stop_source&oldid=173680 " Navigation Support us Recent changes FAQ Offline version Toolbox What links here Related changes Upload file Special pages Printable version Permanent link Page information In other languages Español 日本語 Русский 中文 This page was last modified on 16 July 2024, at 11:31. Privacy policy About cppreference.com Disclaimers